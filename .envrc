#!/usr/bin/env bash
# ABOUTME: Auto-upgrade Claude Code when entering this directory
# ABOUTME: Delegates to scripts/auto-update-all.sh

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

LAST_CHECK_FILE="$SCRIPT_DIR/.last_plugin_check"
TODAY=$(date +%Y-%m-%d)

if [[ -f "$LAST_CHECK_FILE" && "$(cat "$LAST_CHECK_FILE")" == "$TODAY" ]]; then
    :
else
    # Run in subshell with extra fds closed to prevent claudeup's
    # background processes from blocking direnv (which waits for all
    # inherited fds to close before returning)
    (
        exec 3>&- 4>&- 5>&- 6>&- 7>&- 8>&- 9>&-  # close extra fds
        "$SCRIPT_DIR/scripts/auto-update-all.sh"
    ) </dev/null 2>&1
fi

export GIT_USER_EMAIL="marktalston@gmail.com"
export GIT_USER_NAME="Mark Alston"
export DOTFILES_REPO=https://github.com/malston/my-dotfiles.git
export DOTFILES_BRANCH=linux

export GITHUB_TOKEN=$(op read "op://Private/GitHub Personal Access Token/token")
export CONTEXT7_API_KEY=$(op read "op://Private/CONTEXT7_API_KEY/credential")
